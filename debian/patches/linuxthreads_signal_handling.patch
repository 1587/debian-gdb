Description: Temporary support for LinuxThreads signal handling on GNU/kFreeBSD

Author: Robert Millan <rmh@debian.org>
Bug-Debian: http://bugs.debian.org/550361
Bug-Debian: http://bugs.debian.org/669043
Bug-Debian: http://bugs.debian.org/698200
Origin: vendor, http://bugs.debian.org/669043

Index: gdb/gdb/common/signals.c
===================================================================
--- gdb.orig/gdb/common/signals.c	2016-12-12 16:57:27.818426265 +0100
+++ gdb/gdb/common/signals.c	2016-12-12 16:57:27.814426226 +0100
@@ -336,6 +336,15 @@
     return GDB_SIGNAL_LIBRT;
 #endif
 
+#if defined(__GLIBC__) && defined(__FreeBSD_kernel__)
+  if (hostsig == 32)
+    return TARGET_SIGNAL_LINUXTHREADS_RESTART;
+  if (hostsig == 33)
+    return TARGET_SIGNAL_LINUXTHREADS_CANCEL;
+  if (hostsig == 34)
+    return TARGET_SIGNAL_LINUXTHREADS_DEBUG;
+#endif
+
 #if defined (REALTIME_LO)
   if (hostsig >= REALTIME_LO && hostsig < REALTIME_HI)
     {
Index: gdb/include/gdb/signals.def
===================================================================
--- gdb.orig/include/gdb/signals.def	2016-12-12 16:57:27.818426265 +0100
+++ gdb/include/gdb/signals.def	2016-12-12 16:58:41.527153514 +0100
@@ -196,7 +196,11 @@
 
 SET (GDB_SIGNAL_LIBRT, 151, "SIGLIBRT", "librt internal signal")
 
+SET (TARGET_SIGNAL_LINUXTHREADS_RESTART, 152, "32", "LinuxThreads restart signal")
+SET (TARGET_SIGNAL_LINUXTHREADS_CANCEL, 153, "33", "LinuxThreads cancel signal")
+SET (TARGET_SIGNAL_LINUXTHREADS_DEBUG, 154, "34", "LinuxThreads debug signal")
+
 /* If you are adding a new signal, add it just above this comment.  */
 
 /* Last and unused enum value, for sizing arrays, etc.  */
-SET (GDB_SIGNAL_LAST, 152, NULL, "GDB_SIGNAL_LAST")
+SET (GDB_SIGNAL_LAST, 155, NULL, "GDB_SIGNAL_LAST")
